<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz - LT Quiz</title>
  <link rel="icon" type="image/png" href="icon.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: #fff4ec;
      color: #333;
    }

/* Navbar Styles */
.navbar {
  background-color: #fff4ec; /* Light background */
  padding: 10px 0;
  color: black

}

.navbar .navbar-brand {
  display: flex;
  align-items: center;
}

.navbar .navbar-brand img {
  height: 60px;
  font-size: 10px;
}

.navbar-text {
  font-size: 22px;
  color: #000000;
  font-weight: bold;
}



.navbar .navbar-nav {
  margin-left: auto;
}

.navbar .navbar-nav .btn {
  color: #333;
  font-weight: 500;
}

.navbar .navbar-nav .btn:hover {
  color: #f39c12;
  background-color: transparent;
}

/* Navbar Toggle Button for Small Screens */
.navbar-toggler {
  border-color: #f39c12;
}

.navbar-toggler-icon {
  background-color: #f39c12;
}

/* Active Link Styles */
.navbar-nav .nav-item.active .nav-link {
  color: #f39c12;
  font-weight: 600;
}



    .quiz-container {
  max-width: 800px;
  margin: 2rem auto;
  padding: 20px;
}

.quiz-container img {
  display: block; /* Makes the image block-level */

  margin-left: auto; /* Centers the image horizontally */
  margin-right: auto; /* Centers the image horizontally */
}


    .question-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .question-text {
      font-size: 1.1rem;
      margin-bottom: 1.2rem;
      color: #2c3e50;
    }

    .form-check-input:checked {
      background-color: #f39c12;
      border-color: #f39c12;
    }

    .submit-btn {
      background-color: #f39c12;
      border: none;
      padding: 12px 30px;
      font-weight: 600;
      width: 100%;
      max-width: 200px;
    }

    .submit-btn:hover {
      background-color: #ffb43a;

    }

    .construction-block {
      background: #fff4ec;
      border-left: 4px solid #f39c12;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }

    .construction-block img {
      max-width: 100%;
      height: auto;
      margin-top: 15px;
      border-radius: 8px;
    }
    .loading-container {
  display: flex;
  justify-content: center; /* Centers the content horizontally */
  align-items: center; /* Centers the content vertically */
  gap: 10px; /* Adds some space between the spinner and the text */
}

.spinner {
  border: 2px solid #17273b;
  border-top: 2px solid #ffffff;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-text {
  font-weight: bold;
  color: #333;
  font-size: 1.2rem;
}

/* Container for both buttons */
.buttons-container {
  position: relative;
  width: 100%;
  height: 60px; /* Adjust height as needed */
}

/* Back button (top left) */
.back {
  position: absolute;
  top: 0; /* Position at the top */
  left: 0; /* Position at the left */
  border: none;
  background: none;
  color: rgb(0, 0, 0);
  padding: 10px 15px;
  border-radius: 50px;
  cursor: pointer;
  text-decoration: none;
  font-size: 20px;
  z-index: 9999; /* Ensure it stays above other elements */
}

/* Download button (top right) */
.download-btn {
  position: absolute;
  top: 0; /* Position at the top */
  right: 0; /* Position at the right */
  text-align: right;
  border: none;
  background: none;
  color: rgb(0, 0, 0);
  padding: 10px 15px;
  border-radius: 50px;
  cursor: pointer;
  font-size: 20px;
  z-index: 9999; /* Ensure it stays above other elements */
}

/* Hover effects */
.back:hover, .download-btn:hover {
  color: #f39c12; /* Change color on hover */
}

.footer {
    background-color: #fcf0e8 !important;
    border-top: 1px solid #eee4dd;
    margin-top: auto;
    width: 100%;
  }
    
 




    





    /* Add the Scroll to Top Button CSS */
   #myBtn {
  display: none; /* Hidden by default */
  position: fixed; /* Fixed/sticky position */
  bottom: 20px; /* Place the button at the bottom of the page */
  right: 30px; /* Place the button 30px from the right */
  z-index: 99; /* Make sure it does not overlap */
  width: 40px; /* Set width to make it a circle */
  height: 40px; /* Set height to match width */
  font-size: 24px; /* Increase font size */
  border: 2px solid #f39c12; /* Add a solid black border */
  outline: 0.2px solid #f39c12; /* Add a solid black outline */
  background-color: #f39c12; /* Set a background color */
  color: white; /* Text color */
  cursor: pointer; /* Add a mouse pointer on hover */
   box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  padding: 0; /* Remove padding */
  border-radius: 50%; /* Make it a circle */
  transition: background-color 0.3s, color 0.3s, border-color 0.3s, outline-color 0.3s; /* Smooth transitions */
  display: hidden;
  justify-content: center;
  align-items: center; /* Center the text inside the button */
}

#myBtn:hover {
  background-color: #ffc05a; /* Change background color on hover */
  color: white; /* Change text color on hover */
  border-color: #ffc05a; /* Change border color on hover */
  outline-color: #ffc05a; /* Change outline color on hover */
}

/* Timer container styles */
.timer-container {
  position: absolute;
  top: 30px;
  right: 10px;
  font-size: 7px;
background-color: none;
  padding: 10px;
  border-radius: 8px;

}
  </style>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <a class="navbar-brand" href="#">
        <img src="logo.png" alt="Logo" height="50" onclick="home()">
        <span class="navbar-text">Quiz</span>
      </a>
    </div>
  </nav>

  <div class="buttons-container">
    <button onclick="back()" title="Back" class="back"> 
      <i class="fas fa-arrow-left"></i> Back
    </button>
    <!-- Timer -->
<div id="timerContainer" class="timer-container" style="display: none;">
    <h3 id="timer"><i class="far fa-clock"></i>
        <span id="time">00:00</span></h3>
  </div>
    <div class="download-btn">
      <a href="#" id="download-btn" class="btn-link text-dark" title="Download" download>
        <i class="fas fa-download"></i>  Download PDF
      </a>
    </div>
  </div>

  <div class="quiz-container"> 
    <h2 class="text-center mb-4 fw-bold" id="quiz-title">Maths Grade 6 Ministry</h2>
    
    <!-- Start Button -->
    <div class="text-center mb-4">
      <button id="startBtn" title="Start" class="btn submit-btn text-white">Start Quiz</button>
    </div>

    

    <form id="quizForm" style="display: none;">
      <div id="quizContainer" class="mb-4">
        <div class="loading-container">
          <div class="spinner"></div>
          <span class="loading-text">Loading...</span>
        </div>
        <!-- Questions will be injected here -->
      </div>
      
      <div class="text-center">
        <button type="submit" title="Submit" class="btn submit-btn text-white">Submit Quiz</button>
      </div>
    </form>
  </div>

  <!-- Bootstrap Modal -->
  <div class="modal fade" id="resultModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body text-center py-4">
          <img src="https://cdn-icons-png.flaticon.com/128/10792/10792513.png" 
               alt="Result" 
               class="mb-3"
               style="width: 100px;">
          <h3 class="mb-3">Quiz Completed!</h3>
          <p id="resultText" class="lead"></p>
          <button type="button" class="btn btn-warning text-white" data-bs-dismiss="modal">OK</button>
          <button id="retakeBtn" type="button" class="btn btn-secondary">Retake Quiz</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="text-center">
        <small>
          Â© 2016-2024 Oromia Education Bureau (OEB) <br>
          Used under educational fair use policy<br>
          LT Quiz is not affiliated with OEB
          <br><br>
          <strong>Disclaimer:</strong> This site may display third-party advertisements. We do not control or endorse these ads. Please exercise caution when interacting with them.
        </small>
      </div>
    </div>
  </footer>

  <!-- Scroll to Top Button -->
  <button onclick="topFunction()" id="myBtn" title="Go to top"><i class="fa-solid fa-angle-up"></i></button>

  <!-- Existing scripts -->
  <script>
    function back() {
      window.location.href = '/ministry';
    }

    function home() {
      window.location.href = '/';
    }

    // Get the value from the URL fragment (hash)
    const urlFragment = window.location.hash.substring(1);  // This removes the '#' from the fragment

    // Check if there is no fragment and navigate to 404.html
    if (!urlFragment) {
      window.location.href = '4044.html'; // Redirect to 404.html
    } else {
      const titleElement = document.getElementById('quiz-title');
      titleElement.textContent = urlFragment + ' Grade 6 Ministry';  // Update the text
    }

    // Function to update the download link based on the URL fragment
    function updateDownloadLink() {
      const urlFragment = window.location.hash.substring(1);  // This removes the '#'
      const fileName = urlFragment ? `pdf/${urlFragment}.pdf` : 'pdf/default.pdf';  // Default to 'default.pdf' in 'pdf' folder if no fragment
      const downloadLink = document.getElementById('download-btn');
      downloadLink.href = fileName;
    }

    // Run the function when the page loads
    window.onload = updateDownloadLink;

    // Optionally, update the link when the fragment changes (in case the user navigates)
    window.onhashchange = updateDownloadLink;

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDelPBnpY0xv-_ShgWreMZpld_SUWdRwJk",
      authDomain: "lt-website-bf509.firebaseapp.com",
      projectId: "lt-website-bf509",
      storageBucket: "lt-website-bf509.appspot.com",
      messagingSenderId: "43884867628",
      appId: "1:43884867628:web:617a17c06d37b014a86189"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Get the collection name from the URL (after the #)
    const collectionName = window.location.hash.replace('#', '');

    // Ensure the collection name is valid
    if (!collectionName) {
      console.error('No collection name provided in the URL.');
      window.location.href = '4044.html'; // Redirect to 404 page
    } else {
      let quizData = [];
      let constructionSections = []; // Initialize as empty array
      let timerDuration = 0; // Initialize timer duration

      const loadQuiz = () => {
        // Fetch the ajj document first
        db.collection(collectionName).doc('ajj').get()
          .then(doc => {
            if (doc.exists) {
              // Load quiz-specific metadata (e.g., constructionSections, timerDuration)
              constructionSections = doc.data().constructionSections || [];
              timerDuration = doc.data().time || 0; // Load timer duration
            } else {
              console.log('No ajj document found in the collection.');
            }

            // Fetch all quiz questions
            return db.collection(collectionName).get();
          })
          .then(querySnapshot => {
            quizData = querySnapshot.docs
              .filter(doc => doc.id !== 'ajj') // Exclude the ajj document
              .map(doc => doc.data());
            renderQuiz();
          })
          .catch(error => console.error("Error loading quiz:", error));
      };

      const renderQuiz = () => {
        const quizContainer = document.getElementById('quizContainer');
        let html = '';

        quizData.forEach((question, index) => {
          // Check if the current index matches any construction section
          constructionSections.forEach(section => {
            if (index === section.startIndex) {
              html += `
                <div class="construction-block">
                  <div class="fw-bold mb-2">${section.content}</div>
                </div>
              `;
            }
          });

          // Render the question
          html += `
            <div class="question-card">
              <div class="question-text">${index + 1}. ${question.question}</div>
              <div class="choices">
          `;

          // Render the choices
          question.choices.forEach((choice, i) => {
            html += `
              <div class="form-check mb-2">
                <input class="form-check-input" type="radio" 
                       name="q${index}" 
                       id="q${index}-${i}"
                       value="${String.fromCharCode(65 + i)}">
                <label class="form-check-label" for="q${index}-${i}">
                  ${String.fromCharCode(65 + i)}. ${choice}
                </label>
              </div>
            `;
          });

          html += `</div></div>`;
        });

        quizContainer.innerHTML = html;
      };

      // Timer functionality
      let timerInterval;
      const startTimer = (duration) => {
        let timer = duration * 60; // Convert minutes to seconds
        const display = document.getElementById('time');
        document.getElementById('timerContainer').style.display = 'block'; // Show the timer

        timerInterval = setInterval(() => {
          const minutes = Math.floor(timer / 60);
          const seconds = timer % 60;

          display.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

          if (--timer < 0) {
            clearInterval(timerInterval);
            calculateResult(true); // Calculate and display the result when time is up
          }
        }, 1000);
      };

      // Show result modal
      const showResultModal = (message) => {
        const resultText = document.getElementById('resultText');
        resultText.textContent = message;
        const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
        resultModal.show();
      };

      // Calculate and display the result
      const calculateResult = (timeUp = false) => {
        let correctAnswers = 0;
        quizData.forEach((question, index) => {
          const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
          if (selectedOption && selectedOption.value === question.correctAnswer) {
            correctAnswers++;
          }
        });
        const message = timeUp
          ? `Time is up! You got ${correctAnswers} out of ${quizData.length} questions correct!`
          : `You got ${correctAnswers} out of ${quizData.length} questions correct!`;
        showResultModal(message);
      };

      // Start button functionality
      document.getElementById('startBtn').addEventListener('click', () => {
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('quizForm').style.display = 'block';
        startTimer(timerDuration);
      });

      // Submit button functionality
      document.getElementById('quizForm').addEventListener('submit', (e) => {
        e.preventDefault();
        calculateResult();
      });

      // Retake quiz button functionality
      document.getElementById('retakeBtn').addEventListener('click', () => {
        location.reload(); // Reload the page to retake the quiz
      });

      loadQuiz();
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.expand(); // Expand the app to full screen (optional)
        Telegram.WebApp.setHeaderColor("#fff4ec"); // Set the Telegram header color
      }
    });

    // Add the Scroll to Top Button JavaScript
    let mybutton = document.getElementById("myBtn");

    window.onscroll = function() {scrollFunction()};

    function scrollFunction() {
      if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
        mybutton.style.display = "block";
      } else {
        mybutton.style.display = "none";
      }
    }

    function topFunction() {
      document.body.scrollTop = 0; // For Safari
      document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;

    tg.ready();

    // Show the back button
    tg.BackButton.show();

    // Define the behavior for the back button click
    tg.BackButton.onClick(() => {
      window.history.back(); // Go back to the previous page in history
    });

    if (tg) {
      tg.expand();
      tg.enableClosingConfirmation();
      tg.requestFullscreen();
    }
  </script>
</body>
</html>
